<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Motorcycle DynamUI Draggable - Constrain movement</title>
	<link rel="stylesheet" href="jquery-ui-1.10.3/themes/base/jquery.ui.all.css">
	<link rel="stylesheet" href="css/motorcycles.css">
	<script src="jquery-ui-1.10.3/jquery-1.9.1.js"></script>
	<script src="jquery-ui-1.10.3/ui/jquery.ui.core.js"></script>
	<script src="jquery-ui-1.10.3/ui/jquery.ui.widget.js"></script>
	<script src="jquery-ui-1.10.3/ui/jquery.ui.mouse.js"></script>
	<script src="jquery-ui-1.10.3/ui/jquery.ui.draggable.js"></script>
	<script src="jquery-ui-1.10.3/ui/jquery.ui.slider.js"></script>
	<link rel="stylesheet" href="jquery-ui-1.10.3/demos/demos.css">

	<script>
	
	$(function() {
		//set variables

		$( "#speed-slider" ).slider({
			orientation: "vertical",
		    range: "min",
		    value: 60,
		   	min: 0,
		    max: 185,
			step: 5,
		    slide: function( event, ui ) {
				$( "#speed-slider-value" ).val( ui.value + " mph");
				updateBrakingValues();

		    }});
			$( "#speed-slider-value" ).val($( "#speed-slider" ).slider( "value" )+" mph");

		$( "#grip-slider" ).slider({
			orientation: "vertical",
		    range: "min",
			value: 1.12,
		    min: 0,
		    max: 1.6,
			step: 0.01,
		    slide: function( event, ui ) {
				$( "#grip-slider-value" ).val( ui.value);
				updateBrakingValues();
		      }});
		
		$( "#grip-slider-value" ).val($( "#grip-slider" ).slider( "value" ) );
		
		// $( "#grade-slider" ).slider({
		// 	orientation: "vertical",
		// 	range: "min",
		// 	min: -20,
		// 	max: 20,
		// 	step: 1,
		// 	slide: function( event, ui ) {
		// 		$( "#grade-slider-value" ).val( ui.value);
		// 		updateBrakingValues();
		// 	}
		// });
		//     $( "#grade-slider-value" ).val( $( "#grade-slider" ).slider( "value" ) );
        
		
		$( "#draggable" ).draggable({ 
			containment: "#containment-wrapper", scroll: false, 
			start: function() {
				
						},
			drag: function() {

				var p = $("p:first");
				var xPosValue = $("#xPos-value");
				var yPosValue = $("#yPos-value");
//				var coordinates = $("#coordinates"); remove?
				var wheelbase = 55.5;
				var pixelwheelbase = 334;
				pixelheight = 402;
				var position = $(this).position();
				var xPos = wheelbase*(pixelwheelbase-position.left)/(pixelwheelbase);
				var yPos = (pixelheight-position.top)/pixelheight*wheelbase*pixelheight/pixelwheelbase;
				var position = p.position();
				xPosValue.text(xPos);
				yPosValue.text(yPos);
				// coordinates.text(xPos + ", " + yPos); remove?
				updateBrakingValues();
				
			},
			stop: function() {
				updateBrakingValues();

			}
			
		}
			
		);
		
		gravity = 32.17 //feet per second squared
		
		function updateBrakingValues() {
			
			//set variables
			
			var xPos = parseFloat($("#xPos-value").text(), 10);
			var yPos = parseFloat($("#yPos-value").text(), 10);
			// var xPos = 31;
			// var yPos = 32.7;
			var initialSpeed = $( "#speed-slider" ).slider( "values", 1 ) * 88/60;
			var finalSpeed = $( "#speed-slider" ).slider( "values", 0 ) * 88/60;
			var mu = $( "#grip-slider" ).slider( "values", 0 );
			// var grade =$( "#grade-slider" ).slider( "values", 0 ) ;

			//calculate theoretical braking distance (using all traction)
			var theoreticalStop = Math.pow(initialSpeed, 2)/(2*gravity*(mu));
						
			//max braking force before stoppie:
			var stoppieGs = xPos/(yPos);
			
			//max braking usable braking force--either stoppie or all traction
			var maxBraking = Math.min(mu, stoppieGs);
			
			//calculate actual braking distance
			var actualStop = Math.pow(initialSpeed, 2)/(2*gravity*(maxBraking));
			
			//write limiting factor
			if (mu > stoppieGs)
				var limitingFactor = "Limiting-factor: Center of gravity. The bike will stoppie before using all available traction.";
			else
				var limitingFactor = "Limiting-factor: Grip.  The bike will skid before it stoppies.";
			if (xPos == 0)
				var limitingFactor = "The center of gravity is directly over the contact patch (unrealistic).  It is impossible to brake at all without doing an uncontrollable stoppie.";
			if (yPos == 0)
				var limitingFactor = "The center of gravity is directly behind the contact patch (unrealistic).  No matter how much grip the bike has, it cannot raise the rear wheel."
			if ((yPos == 0) && (xPos == 0))
				var limitingFactor = "The center of gravity is at the contact patch (unrealistic).  The bike could brake hard without doing a stoppie.";
			
			
			//update notes
			$('#xPos').text(xPos + "\"");
			$('#yPos').text(yPos + "\"");
			$('#initialSpeed').text(initialSpeed + " fps");
			$('#finalSpeed').text(finalSpeed + " fps");
			$('#grip').text(mu);
			// $('#grade').text(grade + " %");
			$('#stopping-distance-actual').text(actualStop);
			$('#stopping-distance-theoretical').text(theoreticalStop);
			$('#limiting-factor').html(limitingFactor);
			
			//update graph
			$("#stopping-bar-actual").css({width: actualStop});
			$("#stopping-bar-theoretical").css({width: theoreticalStop});
			
			//rotate critical Cg line:
			    var $elies = $("#cg-line");
				// var $eli	= $("#scene"); haven't figure out how to rotate scene
				
			    rotate($elies, (Math.PI/2)*180/Math.PI-Math.atan(mu)*180/Math.PI);
			        function rotate(element, degree) {
			      // For webkit browsers: e.g. Chrome
			           element.css({ WebkitTransform: 'rotate(' + degree + 'deg)'});
			      // For Mozilla browser: e.g. Firefox
			           element.css({ '-moz-transform': 'rotate(' + degree + 'deg)'});
			        }


		}
				updateBrakingValues();
		
	});
	</script>
</head>
<body>
<h2>Is your stop limited by grip or center of gravity?</h3>


<ul id="test">
	<li>
	<div id="scene">
		<div id="limiting-factor"></div>
		<div id="motorcyclist">	
		</div>
		<div id="containment-wrapper">
			<div id="draggable" class="draggable"></div>	
		</div>
		<div id="coordinates" style="background-color: white; margin:5px; padding: 4px; width: 100px; height: 15px;">
			<span id="xPos-value"></span>
			<br>
			<span id="yPos-value"></span>
		</div>
		<div id="cg-line">
			<div id="cg-line-filler"></div>
			<span id="cg-line-text">Cg-limited above this line (stoppie)<br>Traction-limited below this line (skid)</span>
		</div>
	</div>
	</li>
	<li class="slider">
		<p>
  		<label for="speed-slider-value">Braking:</label>
  		<input type="text" id="speed-slider-value" style="border: 0; color: #f6931f; font-weight: bold;" />
	</p>
 
	<div id="speed-slider" style="height: 200px;"></div>
	</li>
	<li class="slider">
	<p>
	  <label for="grip-slider-value">Grip (mu):</label>
	  <input type="text" id="grip-slider-value" style="border: 0; color: #f6931f; font-weight: bold;" />
	</p>

	<div id="grip-slider" style="height: 200px;"></div>
	
	<!-- <p>
	  <label for="grade-slider-value">Grade (%, positive is uphill.):</label>
	  <input type="text" id="grade-slider-value" style="border: 0; color: #f6931f; font-weight: bold;" />
	</p>

	<div id="grade-slider" style="float: left; height: 200px;"></div> -->
	
	</li>
</ul>

	<div id="stopping-bar-actual" style="height: 10px; width: 100px; background-color:red; z-index: 1;"></div>

	<div id="stopping-bar-theoretical" style="height: 10px; width: 100px; background-color:blue;"></div>
</div>

<label for="xPos">X-pos: </label>
<span id="xPos"></span>
<br>

<label for="yPos">Y-pos: </label>
<span id="yPos"></span>
<br>

<label for="initialSpeed">Initial Speed: </label>
<span id="initialSpeed"></span>
<br>

<label for="finalSpeed">Final Speed: </label>
<span id="finalSpeed"></span>
<br>

<label for="grip">Grip (mu): </label>
<span id="grip"></span>
<br>

<label for="grade">Grade: </label>
<span id="grade"></span>
<br>

<label for="stopping-distance-actual">Actual stopping distance: </label>
<span id="stopping-distance-actual">far</span>
<br>

<label for="stopping-distance-theoretical">Theoretical stopping distance: </label>
<span id="stopping-distance-theoretical">short</span>
<br>

</body>
</html>
